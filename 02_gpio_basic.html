<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2024级电赛信号组 - GPIO基础</title>
    <style>
        body {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            font-family: "Microsoft YaHei", sans-serif;
            line-height: 1.8;
        }
        img {
            display: block;
            margin: 10px auto;
            max-width: 100%;
        }
        pre {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>2024级电赛信号组</h1>
    <h2>第二章 GPIO基础与应用</h2>

    <hr>

    <!-- 第一节：GPIO概念 -->
    <h3>1. GPIO概念</h3>
    <p><strong>引脚类型说明：</strong></p>
    <p>单片机上的引脚并非都是GPIO，常见引脚类型如下：</p>
    <ul>
        <li><strong>GPIO引脚</strong>：通用输入输出，可编程控制高低电平，灵活性最高。</li>
        <li><strong>电源引脚</strong>：
            <ul>
                <li><strong>VCC/3V3</strong>：3.3V电源输出，可给外设供电，输出电流有限（通常几十mA）。</li>
                <li><strong>5V</strong>：5V电源输入，供电时可从此引脚输入。</li>
                <li><strong>GND</strong>：地线，所有电路的公共参考地，必须连接。</li>
            </ul>
        </li>
        <li><strong>复位引脚</strong>：NRST，用于芯片复位，低电平有效。</li>
        <li><strong>时钟引脚</strong>：OSC_IN、OSC_OUT，外接晶振提供主时钟。</li>
        <li><strong>调试引脚</strong>：SWDIO、SWCLK（或JTAG），用于程序下载与调试。</li>
        <li><strong>复用功能引脚</strong>：同一GPIO可复用为UART、SPI、I2C、定时器等功能。</li>
    </ul>

    <hr>

    <!-- 第二节：工作模式和原理 -->
    <h3>2. GPIO工作模式与原理</h3>
    <p>STM32F103的GPIO共有8种工作模式，4种输入+4种输出：</p>

    <h3>一、输入模式（4种）</h3>

    <h4>1. 浮空输入</h4>
    <img src="输入浮空1.png" width="1000">
    <p><strong>原理分析：</strong></p>
    <ul>
        <li>内部无上拉、下拉电阻连接</li>
        <li>输出驱动器被禁止，模拟和复用功能输入不起作用</li>
        <li>施密特触发器输入被打开，CPU从输入数据寄存器读取IO口状态</li>
        <li>引脚电平完全由外部输入决定，悬空时电平不确定</li>
    </ul>
    <p><strong>应用场景：</strong>通信协议接收端（如UART RX），外部必须有明确驱动。</p>

    <h4>2. 上拉输入</h4>
    <img src="输入上拉2.png" width="1000">
    <p><strong>原理分析：</strong></p>
    <ul>
        <li>内部上拉电阻起作用，默认状态为高电平</li>
        <li>输出驱动器被禁止，模拟和复用功能输入不起作用</li>
        <li>施密特触发器输入被打开，CPU从输入数据寄存器读取IO口状态</li>
        <li>外部输入低电平时，引脚被拉低；外部悬空时，保持高电平</li>
    </ul>
    <p><strong>应用场景：</strong>按键检测，按键一端接地，按下时输入低电平。</p>

    <h4>3. 下拉输入</h4>
    <img src="输入下拉3.png" width="1000">
    <p><strong>原理分析：</strong></p>
    <ul>
        <li>内部下拉电阻起作用，默认状态为低电平</li>
        <li>输出驱动器被禁止，模拟和复用功能输入不起作用</li>
        <li>施密特触发器输入被打开，CPU从输入数据寄存器读取IO口状态</li>
        <li>外部输入高电平时，引脚被拉高；外部悬空时，保持低电平</li>
    </ul>
    <p><strong>应用场景：</strong>按键检测，按键一端接VCC，按下时输入高电平。</p>

    <h4>4. 模拟输入</h4>
    <img src="模拟模式4.png" width="1000">
    <p><strong>原理分析：</strong></p>
    <ul>
        <li>内部上拉、下拉电阻都不起作用</li>
        <li>信号到达施密特触发器之前直接走模拟通道，不经过数字电路</li>
        <li>ADC采集IO口的电压信号，转换为数字量供CPU读取</li>
        <li>数字输入电路关闭，功耗最低</li>
    </ul>
    <p><strong>应用场景：</strong>ADC采集模拟信号，如传感器电压读取。</p>

    <hr>

    <h3>二、输出模式（4种）</h3>

    <h4>1. 推挽输出</h4>
    <img src="推挽输出3.png" width="1000">
    <p><strong>原理分析：</strong></p>
    <ul>
        <li>输出数据寄存器写1时，P-MOS导通，N-MOS截止，IO口输出VDD（高电平）</li>
        <li>输出数据寄存器写0时，N-MOS导通，P-MOS截止，IO口输出VSS（低电平）</li>
        <li>驱动能力强，可输出高、低两种电平</li>
        <li>CPU可通过输入数据寄存器读取IO口电平状态</li>
    </ul>
    <p><strong>应用场景：</strong>最常用输出模式，如点亮LED、驱动继电器等。</p>

    <h4>2. 开漏输出</h4>
    <img src="开漏输出1.png" width="1000">
    <p><strong>原理分析：</strong></p>
    <ul>
        <li>输出数据寄存器写1时，N-MOS截止，IO口呈高阻态（悬空），需外接上拉电阻才能输出高电平</li>
        <li>输出数据寄存器写0时，N-MOS导通，IO口输出VSS（低电平）</li>
        <li>P-MOS管始终不工作，只能主动输出低电平</li>
        <li>CPU可通过输入数据寄存器读取IO口电平状态</li>
    </ul>
    <p><strong>应用场景：</strong>I2C通信、电平转换、线与逻辑。</p>

    <h4>3. 复用推挽输出</h4>
    <p><strong>原理分析：</strong></p>
    <ul>
        <li>输出控制权交给片上外设（UART、SPI、TIM等），不再由ODR寄存器控制</li>
        <li>内部电路结构与推挽输出相同，P-MOS和N-MOS交替导通</li>
        <li>可输出高、低两种电平，驱动能力强</li>
    </ul>
    <p><strong>应用场景：</strong>UART TX、SPI MOSI/SCK、TIM PWM输出等。</p>

    <h4>4. 复用开漏输出</h4>
    <p><strong>原理分析：</strong></p>
    <ul>
        <li>输出控制权交给片上外设，不再由ODR寄存器控制</li>
        <li>内部电路结构与开漏输出相同，只有N-MOS工作</li>
        <li>需外接上拉电阻才能输出高电平</li>
    </ul>
    <p><strong>应用场景：</strong>I2C SDA/SCL，支持双向通信和线与逻辑。</p>

    <hr>

    <!-- 第三节：使用方法 -->
    <h3>3. GPIO使用方法</h3>
    
    <p><strong>3.1 CubeMX配置步骤：</strong></p>
    <ol>
        <li>在引脚图上点击目标引脚，选择GPIO模式</li>
        <li>配置GPIO属性（上下拉、速度、标签等）</li>
        <li>生成代码</li>
    </ol>

    <p><strong>3.2 HAL库常用函数：</strong></p>
    <pre>
// 写引脚电平
HAL_GPIO_WritePin(GPIOA, GPIO_PIN_5, GPIO_PIN_SET);

// 读引脚电平
HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_0);

// 翻转引脚电平
HAL_GPIO_TogglePin(GPIOA, GPIO_PIN_5);
    </pre>

    <hr>

    <!-- 第四节：实验 -->
    <h3>4. 实验</h3>
    
    <p><strong>实验一：按键控制LED灯</strong></p>
    <ul>
        <li>硬件：STM32F103C8T6最小系统板、LED、按键</li>
        <li>要求：按下按键点亮LED，松开熄灭</li>
        <li><a href="exp1_key_led.html">点击查看实验指导</a></li>
    </ul>

    <p><strong>实验二：软件模拟SPI读写</strong></p>
    <ul>
        <li>硬件：STM32F103C8T6最小系统板、SPI设备（如Flash/W25Q64）</li>
        <li>要求：使用普通GPIO软件模拟SPI时序，完成设备读写</li>
        <li><a href="exp2_soft_spi.html">点击查看实验指导</a></li>
    </ul>

    <hr>

    <!-- 章节导航 -->
    <div style="display: flex; justify-content: space-between; padding: 20px 0;">
        <a href="01_environment_setup.html">← 第一章：开发环境搭建</a>
        <a href="03_xxx.html">第三章 →</a>
    </div>

</body>
</html>
